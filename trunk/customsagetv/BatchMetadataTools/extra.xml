<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project basedir="." default="gwt-package" name="MovieMetadataUpdater">
    <property environment="env"/>
	
	<property name="target" value="target"/>
	<property name="name" value="metadata-updater"/>
	<property name="version" value="1.11"/>
	<property name="jarname" value="${name}-${version}.jar"/>
	<property name="launcher" value="MetadataTool"/>
	
	
	<target name="package" depends="init,copyJars,makeJar,makeLaunch">
		<copy  toDir="${target}">
			<fileset dir="docs">
			</fileset>
		</copy>
		<zip destfile="${name}-${version}.zip">
			<fileset dir="${target}"></fileset>
		</zip>
	</target>
	
	<target name="gwt-package" depends="package">
		<copy toDir="${target}/gwt/">
			<fileset dir="bin" excludes="**/*.properties,/test/*,*.class"/>
		</copy>
		
		<copy  toDir="${target}/gwt/org/jdna/media/super/">
			<fileset dir="src" includes="org/jdna/media/**/I*.java,org/jdna/media/metadata/VideoMetaData.java,org/jdna/media/metadata/CastMember.java,org/jdna/media/metadata/ProviderInfo.java,org/jdna/media/metadata/VideoSearchResult.java,org/jdna/media/metadata/CoverResult.java">
				<exclude name="**/impl/**"/>
			</fileset>
		</copy>
		
		<copy file="gwt/MediaApi.gwt.xml" todir="${target}/gwt/org/jdna/media/"/>
		
		<jar destfile="${target}/gwt-${jarname}">
			<fileset dir="${target}/gwt/"/>
		</jar>
	</target>
	
	
	<target name="copyJars">
		<copydir dest="${target}/libs" src="libs"></copydir>
	</target>

	<target name="makeJar">
		<jar destfile="${target}/libs/${jarname}">
			<fileset dir="bin"></fileset>
		</jar>
	</target>

	<target name="makeLaunch">
		<echo file="${target}/${launcher}.mf">Main-Class: ${launcher}</echo>
		<jar destfile="${target}/${launcher}.jar" manifest="${target}/${launcher}.mf">
			<fileset file="bin/${launcher}.class"/>
		</jar>
		<delete file="${target}/${launcher}.mf"></delete>
	</target>

    <target name="init">
    	<delete dir="target" failonerror="false"></delete>
        <mkdir dir="target"/>
        <copy includeemptydirs="false" todir="bin">
            <fileset dir="src" excludes="**/*.launch, **/*.java"/>
        </copy>
    </target>
    <target name="clean">
        <delete dir="target"/>
    </target>
</project>
