#summary Metadata Tools for SageTV

<wiki:toc max_depth="6" /> 

= Introduction =

Metadata Tools (aka BMT) is a collection of tools for managing and fetching metadata.  Currently it supports fetching metadata from imdb.com, themoviedb.com, tvdb.com.  It also have some support for pulling metadata and fanart from existing DVDProfiler or MyMovies collections.  DVDProfiler and MyMovies support is limited.

Metadata Tools provides a Web UI interface for configuration and managing metadata.  There is also a commandline interface, and metadata can be fetched automatically when new media is added to your collection, if the automatic plugin is also installed and enabled.

= Installation =

Quick Steps
  # Install Jetty
  # Extract BMT archive to SageTV Home
  # Restart SageTV Server
  # goto http://localhost:8080/bmt/

If the installation was successful, then you should now see the default bmt web page, which lists some status about the sagetv/bmt environment.

== Configure Your Metadata Providers ==
The default configuration, for most people, will suffice.  It basically uses a combination of imdb and themoviedb to fetch metadata and fanart for movies, and it uses tvdb.com to fetch metadata and fanart for tv shows.

If you need to configuration something different, then goto Configuration -> Metadata Tools -> Metadata Configuation and set your TV and Movie Providers.

In 4.x, TV and Movie media types have different providers.

== Enabling the Automatic Plugin ==
When using the Automatic Plugin, then when new media items are added to the sagetv library, then BMT will automatically fetch any metadata/fanart for those items.

To enable this plugin, you must register bmt as a sagetv metadata plugin source.  To do this, from the web ui, go to Configuration -> SageTV -> Metadata Settings and set *org.jdna.sage.MetadataUpdaterPlugin* as the Metadata Parser.  Then Save.

You should also set the Custom Metadata Fields, since there are required for fanart.  The custom metadata fields should be *IMDBID;DiscNumber;EpisodeNumber;EpisodeTitle;MediaProviderDataID;MediaTitle;MediaType;OriginalAirDate;SeasonNumber;UserRating;*

Once you enable the plugin, you should also configure how you want the automatic plugin to behave.  To do this, go to, Configuration -> Metadata Tools -> Automatic Plugin Configuration.

From this panel you can configure how the automatic should process files.
  * *Enabled* can be used to disable the plugin without unistalling it
  * *Overwrite Metadata*, if checked, will overwrite existing metadata even it exists.
  * *Overwrite Fanart*, if checked, will overwrite/download fanart even if it exists.
  * *Direct Update of Wiz.bin*, if checked, will directly update the Wiz.bin with metadata.  When this is checked, no .properties are created, and BMT will directly modify the Wiz.bin database using the SageTV apis.  If this is unchecked, then BMT will NOT update the wiz.bin directly, and it will simply create a .properties and allow sagetv to update itself using the .properties.
  * *Import TV as Sage Recordings*, if checked, will import TV media types into the SageTV recordings.  This will implicitly override the Update Wiz.bin flag to true.
  * *Record Failures as System Message*, if checked, will notify SageTV via the System Messages when a media item fails to fetch metadata or fanart.  Otherwise, there is no notification.
  * *Push status updates using System Messages*, if checked, will use the System Messages to provide details on the status of a scan.  Once a series of files have been processed, then a message will be written to the System Messages that will summarize the Success and Failures as a count of each.
  * *Supported MediaResource File Types* allows you to specify which kind of media files you want the automatic plugin to process.  You can specify more than one type by separting them via a comma.  By default ALL_VIDEO is uses, which means, TV, DVDs, BluRays, and normal Video media files.
  * *Create Default STV Thumbnail*, if checked, will create a thumbnail image, in the same directory as the media file, which will allow the default STV to see a better thumbnail for the media file.  If you use SageMC, then you probably don't need to enable this.  But, if you use the default STV, then this will allow the default media browser to use poster thumbnails.

= Performing a Scan =
You can perform a scan by using the Browse action from the Web UI.  When in Browse, you are provided with a list of media sources, ie, Recordings, Videos, etc, and when you navigate them, an *Update Metadata* button is present at the top of the list.  When You select Update Metadata, it will update the metadata for that current folder and optionally the sub folders of the current folder.  You can initiate the scan at any level.

Selecting *Update Metadata*, present your with a dialog box of how you want the scan to proceed.  

  * *Include Sub Folders* - Process current folder and its child folders
  * *Update Metadata* - Update the metadata for all items.  If unchecked the the metadata remains unchanged, but the fanart may still be updated.
  * *Overwrite Existing Metadata* - force an overwrite of existing metadata, otherwise, skip items that have metadta
  * *Create .properties Files* - Create .properties files for each item containing its metadata
  * *Update Fanart* - If unchecked, then fanart is not processed, but metadata may still be updated.
  * *Overwrite Existing Fanart* - Will download fanart even if there is existing fanart.
  * *Generate Thumbanils for Default STV* - Create a Default STV compatible thumbnail/poster. Creates a .jpg of the poster in the same folder as the media item.
  * *Update Wiz.bin* - Directly import metadata into the SageTV database (wiz.bin)
  * *Import TV as Sage Recordings* - Import TV media items into the SageTV recordings. (Forces Update Wiz.bin to true)

Once you have set your scan options, you can then start the scan by pressing the Scan Button.

Once the Scan is in progress, it will add a section below the views for the scanning status.  This status will be updated as the scan progresses.  If you navigate about from this page and then return the status will continue to be updated.

Once a scan has been stated, you can cancel it by clicked the "cancel" link in the status box.  A history of your scans is kept for your review.  You can click on the scan progress, and it will show a panel of your results.  You can then click on the Success or Failed numbers to see a view of the success or failed items.  From that view you can also edit the metadata as you can from any other view.

= Command Line =
Metadata Tools, as of 4.0, still supports a commandline interface.  It is recommended that you review the command line options before using them.  I will assume that if you can adventurous enough to use the command line, then you can read the help for each option.

When using the commandline, you cannot directly update the Wiz.bin.  You will simply create .properties files and fanart files, and then sagetv will use them.

If you have used the 3.x commandline, then I recommend that you review the 4.x commandline, because it has changed.

= How do I ... =
== Force a particular show/series/movie for a given media item? ==
In 3.x, bmt used the metadata.properties file to help with the selection of items.  In 4.x that file is no longer used.  In its place is a new file, scrapers/MediaTitles.xml.  MediaTitles.xml contains items that will be used to force a better query or even for an id result on a query.  For example, consder the following sammple file
{{{
<titles>
	<match>
		<regex>[\\/]Babylon\s*5[\\/]</regex>
		<title>Babylon 5</title>
		<year>1993</year>
		<metadata type="tv" name="tvdb">7072</metadata>
	</match>
	
	<match>
		<file>/home/movies/shared/FindingNemo.avi</file>
		<title>Finding Nemo</title>
		<year>2003</year>
		<metadata name="imdb">tt0266543</metadata>
	</match>
</titles>
}}}

The first <code><match></code> entry will set the Title, Year, and series ID for any media items that are in the Babylon 5 directory.  In this case, title and year are actually not needed, since we are forcing a series id.

The Second <match> entry is forcibly setting the imdbid for a specific file.  Again title and year are not really required here.

A <match> element will consist of ether a <regex> element or a <file> element followed by a <title>, <year> or <metadata> elements.  If only <title> and <year> are passed then the Search Query will be updated to use those values as the title and year search parameters.