<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project basedir="." default="all" name="MovieMetadataUpdater">
    <property environment="env"/>
	
	<property name="target" value="target"/>
	<property name="name" value="metadata-updater"/>
	<property name="version" value="1.15"/>
	<property name="jarname" value="${name}-${version}.jar"/>
	<property name="launcher" value="MetadataTool"/>
	
	
	<target name="all" depends="gwt-package,plugin-package"/>
	
	<target name="package" depends="init,copyJars,makeJar,makeLaunch">
		<copy  toDir="${target}/tool">
			<fileset dir="docs">
			</fileset>
		</copy>
		<zip destfile="${target}/${name}-${version}.zip">
			<fileset dir="${target}/tool"></fileset>
		</zip>
	</target>
	
	<target name="gwt-package" depends="package">
		<copy toDir="${target}/gwt/">
			<fileset dir="bin" excludes="**/*.properties,/test/*,*.class"/>
		</copy>
		
		<copy  toDir="${target}/gwt/org/jdna/media/super/">
			<fileset dir="src" includes="org/jdna/media/**/I*.java,org/jdna/media/metadata/VideoMetaData.java,org/jdna/media/metadata/CastMember.java,org/jdna/media/metadata/ProviderInfo.java,org/jdna/media/metadata/VideoSearchResult.java,org/jdna/media/metadata/CoverResult.java">
				<exclude name="**/impl/**"/>
			</fileset>
		</copy>
		
		<copy file="gwt/MediaApi.gwt.xml" todir="${target}/gwt/org/jdna/media/"/>
		
		<jar destfile="${target}/gwt-${jarname}">
			<fileset dir="${target}/gwt/"/>
		</jar>
	</target>

	<target name="plugin-package" depends="package">
		<mkdir dir="${target}/sage"/>
		<mkdir dir="${target}/sage/JARs"/>
		
		<copy toDir="${target}/sage/JARs">
			<fileset dir="libs" excludes="Sage.*,nielm*,"/>
		</copy>
		
		<copy toDir="${target}/sage/JARs">
			<fileset file="${target}/tool/libs/${jarname}"/>
		</copy>

		<echo file="${target}/sage/Sage.properties.metadataupdater">mediafile_metadata_parser_plugins=org.jdna.sage.MetadataUpdaterPlugin</echo>

		<zip destfile="${target}/${name}-plugin-${version}.zip" basedir="${target}/sage"/>
	</target>
	
	
	<target name="copyJars">
		<copydir dest="${target}/tool/libs" src="libs" excludes="Sage*.jar"></copydir>
	</target>

	<target name="makeJar">
		<jar destfile="${target}/tool/libs/${jarname}">
			<fileset dir="bin"></fileset>
		</jar>
	</target>

	<target name="makeLaunch">
		<echo file="${target}/${launcher}.mf">Main-Class: ${launcher}</echo>
		<jar destfile="${target}/tool/${launcher}.jar" manifest="${target}/${launcher}.mf">
			<fileset file="bin/${launcher}.class"/>
		</jar>
		<delete file="${target}/${launcher}.mf"></delete>
	</target>

    <target name="init">
    	<delete dir="target" failonerror="false"></delete>
        <mkdir dir="target"/>
        <copy includeemptydirs="false" todir="bin">
            <fileset dir="src" excludes="**/*.launch, **/*.java"/>
        </copy>
    </target>
	
    <target name="clean">
        <delete dir="target"/>
    </target>
	
	<target name="generate-constants">
		<xslt style="src/org/jdna/media/metadata/MetadataKey.xsl" in="src/org/jdna/media/metadata/MetadataKey.xml" out="src/org/jdna/media/metadata/MetadataKey.java"></xslt>
	</target>
</project>
